
<!DOCTYPE html>
<head>
<style>

#about {
    position: absolute;
    color: #333;
    z-index: 5;
    cursor: default;
	top: 10px;
	right: 20px;
	text-align: left;
}

#about.en {
	top: 10px;
	right: 100px;
}

#about .button {
	padding: 3px;
    position: absolute;
	right: 20px;
	width: 100px;
	text-align: right;
    cursor: pointer;
	text-decoration: underline;
}

#about div {
    overflow: hidden;
    height: 0;
    background: #fff;
    width: 0;
}

#about .help {
    color: black;
    font-style: italic;
}

#about .contact {
    font-size: 75%;
}

#about:hover a {
    color: black;
}

#about:hover {
	z-index: 10;
}

#about:hover div {
    width: 400px;
    height: auto;
    border: 1px solid #666;
    padding: 0.5ex 1em;
    hyphens: auto;
    -webkit-hyphens: auto;
    -moz-hyphens: auto;
	z-index: 10;
}


body {
	font-family: sans-serif;
	width: 100%;
	padding: 0;
	margin: 0;
}

canvas {
	display: block;
	margin: auto;
}

form {
	position: fixed;
}

.border {
	stroke: grey;
	stroke-width: 2px;
	fill: none;
}
.river {
	stroke: #ABCDEF;
	stroke-width: 1px;
	fill: none;
}
.cell {
	stroke: white;
	stroke-width: 2px;
	stroke-opacity: 0;
}
.cell:hover {
	stroke-opacity: 1;
}

#scale {
	margin: 8px;
	vertical-align: middle;
	display: inline-block;
	position: absolute;
	width: 400px;
	height: 20px;
	background: #ff0000;
	background: -moz-linear-gradient(left,  #ff0000 0%, #ffff00 25%, #007f08 50%, turquoise 75%, blue 100%);
	background: -webkit-gradient(linear, left top, right top, color-stop(0%,#ff0000), color-stop(25%,#ffff00), color-stop(50%,#007f08), color-stop(75%,turquoise), color-stop(100%,blue));
	background: -webkit-linear-gradient(left,  #ff0000 0%,#ffff00 25%,#007f08 50%,turquoise 75%,blue 100%);
	background: -o-linear-gradient(left,  #ff0000 0%,#ffff00 25%,#007f08 50%,turquoise 75%,blue 100%);
	background: -ms-linear-gradient(left,  #ff0000 0%,#ffff00 25%,#007f08 50%,turquoise 75%,blue 100%);
	background: linear-gradient(to right,  #ff0000 0%,#ffff00 25%,#007f08 50%,turquoise 75%,blue 100%);
	color: white;
	font-weight: bold;
	text-shadow: 0 0 3px black;
}

#scale.colorblind {
	background: #ff0000;
	background: -moz-linear-gradient(left,                                  yellow 0%,              lightblue 25%,             blue 50%,             darkblue 75%,              black 100%);
	background: -webkit-gradient(linear, left top, right top, color-stop(0%,yellow), color-stop(25%,lightblue), color-stop(50%,blue), color-stop(75%,darkblue), color-stop(100%,black));
	background: -webkit-linear-gradient(left,                               yellow 0%,              lightblue 25%,             blue 50%,             darkblue 75%,              black 100%);
	background: -o-linear-gradient(left,                                    yellow 0%,              lightblue 25%,             blue 50%,             darkblue 75%,              black 100%);
	background: -ms-linear-gradient(left,                                   yellow 0%,              lightblue 25%,             blue 50%,             darkblue 75%,              black 100%);
	background: linear-gradient(to right,                                   yellow 0%,              lightblue 25%,             blue 50%,             darkblue 75%,              black 100%);
}

#scale .label-left {
	position: absolute;
	left: 10px;
	height: 20px;
	vertical-align: middle;
	line-height: 20px;
}

#scale .label-right {
	position: absolute;
	right: 10px;
	height: 20px;
	vertical-align: middle;
	line-height: 20px;
}

#scale .label-center {
	width: 400px;
	display: inline-block;
	text-align: center;
	height: 20px;
	vertical-align: middle;
	line-height: 20px;
}

#legende {
	margin: 8px;
	position: absolute;
	top: 30px;
	width: 400px;
	text-align: center;
	font-weight: bold;
	font-size: 20px;
}

#legende[lang=en] {
	top: 90px;
	font-size: 16px;
}

#colorblind-form {
	margin-top: 8px;
	margin-left: 420px;
}

#colorblind {
	vertical-align: middle;
}

label[for="colorblind"] {
	display: inline-block;
	vertical-align: middle;
	font-size: 90%;
}

label[for="colorblind"] [lang="en"] {
	font-size: 80%;
}

.waiting {
	cursor: wait !important;
}

.waiting #colorblind {
	display: none;
}

.waiting #colorblind + label {
	background: url('spin.gif');
	background-repeat: no-repeat;
	padding-left: 20px;
}

</style>

<title>Parité des conseils municipaux, 2008.</title>
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@badaseong" />

<meta property="og:site_name" content="Ssz.fr">
<meta property="og:url" content="https://ssz.fr/parite">
<meta property="og:title" content="Parité des conseils municipaux, 2008." />
<meta property="og:image" content="http://render.sauf.ca/parite" />
<meta property="og:image:height" content="768" />
<meta property="og:image:width"  content="1024" />
<meta property="og:image:type" content="image/png" />
<meta property="og:locale" content="fr_FR" />
<meta property="og:locale:alternate" content="en_US" />
<meta property="og:description" content="Parité dans les conseils municipaux des communes de métropole, après les élections municipales de 2008." />
<meta name="description"        content="Parité dans les conseils municipaux des communes de métropole, après les élections municipales de 2008." />

</head>
<body>

<div id="about" class="fr">
	<a class="button">À propos</a>
	<div lang="fr">
		<p>Parité dans les conseils municipaux des communes de métropole, après les élections municipales de 2008.</p>
		<p>Le vert indique une relative parité, le rouge une importante majorité d'hommes, le bleu de femmes
		(mais ce dernier cas est rare : 10 communes avec plus de 75% de femmes, pour 8000 avec plus de 75% d'hommes).</p>
		<p>Données du <a href="http://www.interieur.gouv.fr/Elections/Les-resultats/Municipales/elecresult__municipales_2008/(path)/municipales_2008/index.html">Ministère de l'Intérieur</a>,
		limites des communes prises chez <a href="https://github.com/kerneis/france-choropleth">github.com/kerneis</a>.</p>
		<p class="contact"><a href="mailto:see@seos.fr">Contact</a> // <a href="//ssz.fr/">Accueil</a></p>
	</div>
</div>

<div id="about" class="en">
	<a class="button">About</a>
	<div lang="en">
		<p>Gender equality in French city councils, according to 2008 municipal election results..</p>
		<p>Green when each gender is represented equaly, red indicates a majority of men, blue a majority of women
		(the latter is rare: 10 city councils have more than 75% women, while 8000 have more than 75% men).</p>
		<p>Data from <a href="http://www.interieur.gouv.fr/Elections/Les-resultats/Municipales/elecresult__municipales_2008/(path)/municipales_2008/index.html">Minister of the Interior</a>.
		city limits from <a href="https://github.com/kerneis/france-choropleth">github.com/kerneis</a>.</p>
		<p class="contact"><a href="mailto:see@seos.fr">Contact</a> // <a href="//ssz.fr/">Home</a></p>
	</div>
</div>

<div id="scale"><span class="label-left">0%</span><span class="label-center">50%<span class="label-right">100%</label></div>
<h1 id="legende" lang="fr">Pourcentage de femmes parmi les élus des conseils municipaux, 2008.</h1>
<h1 id="legende" lang="en">Percent women in city councils, 2008.</h1>

<form id="colorblind-form"><input type="checkbox" name="colorblind" id="colorblind" /><label for="colorblind"><span lang="fr">couleurs adaptées aux daltoniens</span><br /><span lang="en">colorblind-friendly gradient</span></label></form>

<script src="d3.v3.min.js"></script>
<script src="topojson.v1.js"></script>
<script src="queue.v1.min.js"></script>

<script>

var height = window.innerHeight - 10,
	width = height + 100;

var projection = d3.geo.albers()
	.center([1, 46.5])
	.rotate([-2, 0])
	.parallels([30, 50])
	.translate([width/2, height/2]);

projection.scale(3900 * (height/700));

var canvas = d3.select("body").append("canvas")
	.style("z-index", "-2")
    .attr("width", width)
    .attr("height", height)[0][0].getContext('2d');

var path = d3.geo.path()
	.projection(projection);

queue()
    .defer(d3.json, "communes.topojson")
    //.defer(d3.json, "rivers.json")
    //.defer(d3.tsv, "parite.tsv")
    .await(function(error, communes, rivers, parite) {
		var normal_scale = d3.scale.linear()
			.range(['red', 'yellow', 'green', 'turquoise', 'blue'])
			.domain([0, 25, 50, 75, 100]);

		var colorblind_scale = d3.scale.linear()
			.range(['yellow', 'lightblue', 'blue', 'darkblue', 'black'])
			.domain([0, 25, 50, 75, 100]);

		var normal_color = function(d) {
			return normal_scale(parite.get(d.id));
		};

		var colorblind_color = function(d) {
			return colorblind_scale(parite.get(d.id));
		};

		var color = normal_color;

		/*parite = d3.nest()
			.key(function(d) {return d.code_insee;})
			.rollup(function(d) {return d[0].pourcentage_femmes;})
			.map(parite, d3.map);*/

		var drawCommunes = function(data) {
			canvas.clearRect(0, 0, width, height);

			data.forEach(function(o) {
				var topo = topojson.feature(communes, o).features;

				canvas.strokeStyle = '#cccccc';
				drawPolygons(topo, canvas, color);
			});
		};
		drawCommunes(d3.map(communes.objects).values());

		/*d3.map(rivers.objects).values().forEach(function(o) {
			var topo = topojson.mesh(rivers, o);

			canvas.strokeStyle = '#ABCDEF';
			drawLine(topo, canvas, false);
		});

		d3.select('#colorblind').on('change', function() {
			d3.select('body').attr('class', 'waiting');

			if (this.checked) {
				color = colorblind_color;
				d3.select('#scale').attr('class', 'colorblind');
			} else {
				color = normal_color;
				d3.select('#scale').attr('class', '');
			}

			setTimeout(function() {
				drawCommunes(d3.map(communes.objects).values());
				d3.select('body').attr('class', '');
			}, 100);
		});*/
});

var drawPolygons = function(d, canvas, fill) {
    d.forEach(function(d) {
        canvas.beginPath();
        if (fill) {
            if (fill instanceof Function) {
                canvas.fillStyle = fill(d).toString();
            }
        }

        var coordinates = d.geometry.coordinates;
        if (coordinates) coordinates[0].forEach(function(c, i) {
            var coordinates = projection(c);
            if (null == coordinates || coordinates == [NaN, NaN]) {
                return;
            }
            if (i == 0) {
                canvas.moveTo(coordinates[0], coordinates[1]);
            } else {
                canvas.lineTo(coordinates[0], coordinates[1]);
            }
        });
        if (fill) {
            canvas.closePath();
            canvas.fill();
        }
        canvas.stroke();
    });
};

var drawLine = function(d, canvas, fill) {
    if (d.coordinates) d.coordinates.forEach(function(c) {
        canvas.beginPath();
        c.forEach(function(p, i) {
            var coordinates = projection(p);
            if (null == coordinates) {
                return;
            }
            if (i == 0) {
                canvas.moveTo(coordinates[0], coordinates[1]);
            } else {
                canvas.lineTo(coordinates[0], coordinates[1]);
            }
        });
        if (fill) {
            canvas.closePath();
            canvas.fill();
        }
        canvas.stroke();
    });
};

</script>
</body>
